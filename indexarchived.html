<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Solitaire</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="mx-auto max-w-6xl">
    <div class="container flex justify-center mx-auto">
      <h1  class="text-5xl pt-2">Welcome to Solitaire!</h1>
      <div class="pl-5 pt-3">
        <button
          id="play"
          class="border border-black rounded px-6 py-2 text-lg font-bold bg-black text-white"
          onclick="createDeck()">
          Shuffle
        </button>
      </div>
    </div>

    <!-- <div class="pt-2 flex justify-start gap-1 pl-5">
        <div id="deck" class="w-[150px] h-[200px] pl-2"></div>
        <div class="rounded border border-black w-[150px] h-[200px] pl-2">
          Pile
        </div>
        <div class="rounded border border-black w-[150px] h-[200px] pl-2">
          Pile
        </div>
        <div class="rounded border border-black w-[150px] h-[200px] pl-2">
          Pile
        </div> -->
        <div>

      <div class="container flex justify-center mx-auto">

      <div class="pt-2 flex justify-start gap-1">
        <div id="deck" class="w-[150px] h-[200px] pl-2"></div>
        <div id="pile-1" class="pile rounded border border-black w-[150px] h-[200px] pl-2">
          Talon Pile
        </div>
        <div id="pile-2"class="rounded border border-black w-[150px] h-[200px] pl-2">
          Talon Pile
        </div>
        <div id="pile-3" class="rounded border border-black w-[150px] h-[200px] pl-2">
          Talon Pile
        </div>
      </div>
        <div class="pl-20 pt-2 flex justify-end gap-1">
          <div class="rounded border border-black w-[150px] h-[200px] pl-2">
            Spade
          </div>
          <div class="rounded border border-black w-[150px] h-[200px] pl-2">
            Club
          </div>
          <div class="rounded border border-black w-[150px] h-[200px] pl-2">
            Heart
          </div>
          <div class="rounded border border-black w-[150px] h-[200px] pl-2">
            Diamond
          </div>
        </div>
      </div>
    </div>

    
    </div>
    <div  id="tableau" class="pt-2 flex justify-between gap-1"></div>

    <script>
      let deckId;
      let cards;
      let remainingCards;
      let stockPile = []; // Represents the stock pile (face down cards)
      let wastePile = []; // Represents the waste pile (face up cards)

      // async function createDeck() {
      //   try {
      //     const response = await fetch(
      //       "https://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1"
      //     );
      //     const data = await response.json();
      //     deckId = data.deck_id;
      //     await drawCards(28);
      //     createTableau(cards);
      //   } catch (error) {
      //     console.log("Error Creating Deck", error);
      //   }
      // }

      // Modify createDeck like this:
      async function createDeck() {
        try {
          const response = await fetch(
            "https://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1"
          );
          const data = await response.json();
          deckId = data.deck_id;
          await drawCards(28);
          createTableau(cards);
          await drawRemainingCards(data.remaining); // Draw the remaining cards into the stock pile
          displayStockPile(); // Show the cards in the stock pile
        } catch (error) {
          console.log("Error Creating Deck", error);
        }
      }

      // Create drawRemainingCards like this:
      async function drawRemainingCards(remainingCards) {
        try {
          const response = await fetch(
            `https://deckofcardsapi.com/api/deck/${deckId}/draw/?count=${remainingCards}`
          );
          const data = await response.json();
          stockPile = data.cards;
        } catch (error) {
          console.log("Error drawing remaining cards:", error);
        }
      }

      // Create displayStockPile like this:
      function displayStockPile() {
        const deck = document.getElementById("deck");
        if (stockPile.length > 0) {
          deck.innerHTML = `<img src="src/back.png" alt="Card Back">`;
        } else {
          deck.innerHTML = ""; // Empty if no cards
        }
        deck.onclick = talonPileDraw; // Attach the draw function
      }

      // Create talonPileDraw like this:
      function talonPileDraw() {
        for (let i = 0; i < 3 && stockPile.length > 0; i++) {
          wastePile.push(stockPile.pop());
        }
        displayWastePile(); // Show the cards in the waste pile
        displayStockPile(); // Update the stock pile display
      }

      // Create displayWastePile like this:
      function displayWastePile() {
        const pile = document.querySelector(".pile"); // Add a class "pile" to your pile div
        if (wastePile.length > 0) {
          const card = wastePile[wastePile.length - 1]; // Get the last card
          pile.innerHTML = `<img src="${card.image}" alt="${card.code}">`;
        } else {
          pile.innerHTML = ""; // Empty if no cards
        }
      }

      document.getElementById("shuffle").onclick = async function () {
        let response = await fetch(
          "https://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1&remaining=true"
        );
        let data = await response.json();

        let drawResponse = await fetch(
          `https://deckofcardsapi.com/api/deck/${data.deck_id}/draw/?count=${remainingCards}`
        );
        let drawData = await drawResponse.json();

        console.log("Deck of Cards:", cards);
      };

      async function drawCards(count) {
        try {
          const response = await fetch(
            `https://deckofcardsapi.com/api/deck/${deckId}/draw/?count=${count}`
          );
          const data = await response.json();
          cards = data.cards;
          remainingCards = data.remaining; // Update remaining cards
          console.log(remainingCards, "cards remaining in the deck");
          console.log("Deck of Cards:", cards);
        } catch (error) {
          console.log("Error drawing cards:", error);
        }
      }

      let selectedCard = null;

      function getCardColor(cardCode) {
        const suit = cardCode[cardCode.length - 1]; // get the last character of the card code
        switch (suit) {
          case "H":
          case "D":
            return "red";
          case "S":
          case "C":
            return "black";
          default:
            throw new Error(`Invalid suit: ${suit}`);
        }
      }

      function flipLastCard(column) {
        const cardsInColumn = column.querySelectorAll(".rounded");
        const lastCard = cardsInColumn[cardsInColumn.length - 1];
        if (lastCard) {
          let cardValue = lastCard.getAttribute("data-value");
          lastCard.innerHTML = `<img src="https://deckofcardsapi.com/static/img/${cardValue}.png" alt="${cardValue}">`;
        }
      }

      function createTableau(cards) {
        const deck = document.getElementById("deck");
        deck.innerHTML = `<img src="src/back.png" alt="Card Back">`;
        const tableau = document.getElementById("tableau");
        tableau.innerHTML = "";

        for (let i = 0; i < 7; i++) {
          let column = document.createElement("div");
          column.className = "";

          for (let j = 0; j <= i; j++) {
            let card = document.createElement("div");

            let cardValue = cards[(i * (i + 1)) / 2 + j].code;
            const color = getCardColor(cardValue);

            card.className =
              "rounded w-[150px] h-[200px] pt-2 focus:outline-none focus:ring focus:ring-violet-300";
            card.setAttribute("data-value", cardValue); // Store card value for later

            if (j === i) {
              // Card is face up
              card.innerHTML = `<img src="https://deckofcardsapi.com/static/img/${cardValue}.png" alt="${cardValue}">`;
            } else {
              // Card is face down
              card.innerHTML = `<img src="src/back.png" alt="Card Back">`;
            }

            card.onclick = function () {
              console.log(`Card clicked: ${cardValue}`);
              if (selectedCard) {
                const oldColumn = selectedCard.parentNode;
                column.appendChild(selectedCard);
                flipLastCard(oldColumn);
                selectedCard = null;
              } else {
                selectedCard = card;
              }
            };
            column.appendChild(card);
          }

          tableau.appendChild(column);
        }
      }
    </script>
  </body>
</html>
